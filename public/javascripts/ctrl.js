// Generated by CoffeeScript 1.11.1
(function() {
  var Login;

  angular.module('pupilApp').controller('userCtrl', [
    '$scope', 'Model', function($scope, Model) {
      var refreshUsers;
      console.log('userCtrl');
      refreshUsers = function() {
        return Model.get_user_list().then(function(d) {
          return $scope.users = d.data;
        });
      };
      $scope.remove = function(id) {
        console.log(id);
        return Model.remove(id, function() {
          return refreshUsers();
        });
      };
      $scope.edit = function(id) {
        $scope.user = $scope.users[id];
        return $scope.user.is_edit = true;
      };
      $scope.save = function() {
        console.log('saving');
        Model.save($scope.user, function() {
          return refreshUsers();
        });
        return $scope.user = {};
      };
      return refreshUsers();
    }
  ]).controller('pageCtrl', [
    '$scope', 'Page', '$location', function($scope, Page, $location) {
      var update_list;
      update_list = function() {
        return Page.list(function(r) {
          return $scope.pages = r.data;
        });
      };
      return update_list();
    }
  ]).controller('loginCtrl', [
    '$scope', 'LoginService', function($scope, LoginService) {
      return $scope.login = function() {
        return LoginService.login($scope.username, $scope.password, function(rez) {
          $scope.message = rez.data;
          if (!$scope.message.success) {
            console.log($scope.message);
            $scope.is_error = true;
            return $scope.error_message = $scope.message.message;
          } else {
            return $scope.is_authenticated = true;
          }
        });
      };
    }
  ]).factory('LoginFactory', function($http) {
    var login;
    login = function(login, password, callback) {
      var data;
      data = {
        name: login,
        password: password
      };
      return $http.post('/login', data).then(callback);
    };
    return {
      login: login
    };
  }).service('LoginService', [
    '$http', Login = (function() {
      function Login($http1) {
        this.$http = $http1;
      }

      Login.prototype.login = function(login, password, callback) {
        var data;
        data = {
          name: login,
          password: password
        };
        return this.$http.post('/login', data).then(callback);
      };

      return Login;

    })()
  ]).controller('uploadCtrl', [
    '$scope', 'FileUploader', function($scope, FileUploader) {
      return $scope.uploader = new FileUploader();
    }
  ]).controller('fbCtrl', [
    '$scope', '$firebaseObject', '$firebaseArray', function($scope, $firebaseObject, $firebaseArray) {
      var config, ref;
      config = {
        apiKey: 'AIzaSyBo4BEA7jAy7bGdKjjgrOYl9Ug6kVFy77E',
        authDomain: 'firstprj-2238d.firebaseapp.com',
        databaseURL: 'https://firstprj-2238d.firebaseio.com/'
      };
      firebase.initializeApp(config);
      ref = firebase.database().ref();
      $scope.data = $firebaseArray(ref);
      ref = firebase.database().ref().child("log");
      $scope.log = $firebaseArray(ref);
      console.log($scope.log);
      $scope.add = function() {
        return $scope.log.$add({
          title: $scope.title,
          time: $scope.time
        });
      };
      $scope.remove = function(id) {
        return $scope.log.$remove($scope.log.$getRecord(id));
      };
      $scope.remove_all = function(id) {
        return firebase.database().ref().child("log").remove();
      };
      $scope.edit = function(id, key) {
        var r;
        r = $scope.log.$getRecord(id);
        r.title = $scope.log[key].title;
        return $scope.log.$save(r);
      };
      return $scope.$watch('log', function() {
        return angular.forEach($scope.log, function(v, k) {
          var r;
          r = $scope.log.$getRecord(v.$id);
          r.title = $scope.log[k].title;
          $scope.log.$save(r);
          return console.log(k);
        });
      }, true);

      /*
      $scope.log = [
                      {id: 1, title: 'test', time: '12-00'},
                      {id: 1, title: 'test', time: '12-00'},
                     ]
       */
    }
  ]);

}).call(this);
